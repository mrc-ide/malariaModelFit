---
title: "check_equilibrium"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This package contains two sets of code for returning the equilibrium solution to the Griffin et al. 2014 transmission model. The first was written in R by Jamie Griffin, and the second was written in Rcpp by Xiaoyu Li, before being adapted into package format by Bob Verity. Here we will compare both sets of code to establish 1) that both sets of code produce the same results, 2) which code set if faster and by how much.

## Install package

Start by installing and loading the package. Run the following lines, where the first line is uncommented and `my_token` is replaced with your personal Github personal access token (this is required as the package is currently private).

```{r}
# install_github("mrc-ide/malariaModelFit", auth_token=my_token)
library(malariaModelFit)
```

## Compare solutions

Required inputs when determining the equilibrium solution include; entomological innoculation rate (EIR), treatment coverage (ft), a vector of parameters (p), the age distribution of the population (age), and biting heterogeneity in the form of Gaussian quadrature (h). We will fix age and biting heterogeneity and draw `n` random values for the other inputs.

```{r}
n <- 1e2 # number of random inputs to explore

age <- default_age()
h <- statmod::gauss.quad.prob(9, dist="normal")
EIR <- runif(n,1,100)
ft <- runif(n,0.5,0.5)
p <- random_parameters(n)
```

TODO - Run both sets of code

```{r}
prev_2_10_method1 <- prev_2_10_method2 <- rep(NA,n)
for (i in 1:n) {
  eq1 <- human_equilibrium(EIR=EIR[i], ft=ft[i], p=p[[i]], age=age, h=h)
  eq2 <- human_equilibrium_fast(EIR=EIR[i], ft=ft[i], p=p[[i]], age=age, h$nodes, h$weights)
  
  prev_2_10_method1[i] <- find_prev(eq1, 2, 10)
  prev_2_10_method2[i] <- find_prev(eq2, 2, 10)
}

plot(EIR, prev_2_10_method1)
points(EIR, prev_2_10_method2, pch=20, cex=0.5)
```

